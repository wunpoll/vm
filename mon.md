## Часть 1: Обоснование выбора программного обеспечения

1.  **Операционная система:** **Ubuntu Server 22.04 LTS**.
    *   **Обоснование:** Стабильная, безопасная система с долгосрочной поддержкой. Огромное сообщество и поддержка со стороны разработчиков ПО для мониторинга делают ее идеальным выбором.

2.  **Сбор, анализ и визуализация метрик:** **Стек Prometheus + Grafana**.
    *   **Обоснование:** Это современный промышленный стандарт. **Prometheus** отлично собирает метрики производительности (CPU, RAM, сеть) с серверов и приложений с помощью *экспортеров*. **Grafana** — лучший инструмент для создания наглядных дашбордов на основе данных из Prometheus. Стек легко масштабируется путем добавления новых экспортеров и серверов.

3.  **Доступ к журналам событий (логам):** **Стек Promtail + Loki**.
    *   **Обоснование:** Loki — это система сбора логов, разработанная Grafana Labs. Ее называют "Prometheus для логов". Она не индексирует содержимое логов, а только метаданные (метки), что делает ее очень быстрой и ресурсоэффективной. **Promtail** — это агент, который собирает логи с машин и отправляет их в Loki. Этот стек идеально интегрируется с Grafana, позволяя просматривать метрики и логи в одном интерфейсе.

4.  **Автоматические уведомления:** **Alertmanager**.
    *   **Обоснование:** Alertmanager — это компонент экосистемы Prometheus, созданный специально для обработки оповещений. Он получает алерты от Prometheus, может их группировать, подавлять дубликаты и отправлять через различные каналы (Email, Slack, Telegram и т.д.). Это мощный и гибкий инструмент, полностью отвечающий требованиям билета.

5.  **Базовая защита и разграничение прав:** **UFW, Fail2ban и стандартные пользователи Linux**.
    *   **Обоснование:** **UFW** (Uncomplicated Firewall) надежно защищает сервер, открывая только необходимые порты. **Fail2ban** обеспечивает дополнительную защиту от брутфорс-атак на сервисы (например, SSH). Стандартный механизм пользователей и групп в Linux позволяет гибко разграничить права, например, создав пользователя `viewer` с ограниченными правами только на просмотр дашбордов.

6.  **Компонент для документирования:** **Grafana**.
    *   **Обоснование:** Grafana является основным пользовательским интерфейсом всего комплекса. Именно с ней будут работать другие сотрудники для анализа состояния систем. Поэтому создание «Руководства пользователя» для Grafana наиболее логично и полезно.

---

## Часть 2: Пошаговый план установки и настройки (Команды)

### Шаг 0: Подготовка системы

```bash
sudo apt update && sudo apt full-upgrade -y
sudo apt install -y curl wget htop
```

### Шаг 1: Настройка безопасности (UFW и Fail2ban)

**Теория:** Настраиваем брандмауэр и защиту от перебора паролей.

```bash
# Настраиваем брандмауэр
sudo ufw allow ssh          # 22/tcp
sudo ufw allow 3000/tcp     # Grafana
sudo ufw allow 9090/tcp     # Prometheus
sudo ufw allow 9093/tcp     # Alertmanager
sudo ufw allow 9100/tcp     # Node Exporter (сбор метрик с этого же хоста)

# Включаем брандмауэр
sudo ufw enable

# Устанавливаем и включаем Fail2ban (защита от брутфорса SSH)
sudo apt install -y fail2ban
sudo systemctl enable --now fail2ban
sudo systemctl status fail2ban
```

### Шаг 2: Установка стека мониторинга (Prometheus + Node Exporter)

**Теория:** Устанавливаем Prometheus для сбора данных и Node Exporter для предоставления метрик о системе.

```bash
# Устанавливаем компоненты из репозиториев
sudo apt install -y prometheus prometheus-node-exporter prometheus-alertmanager

# Настроим Prometheus для сбора данных с себя и для отправки алертов в Alertmanager
sudo nano /etc/prometheus/prometheus.yml
```
**Содержимое файла `prometheus.yml` (приведите его к такому виду):**
```yaml
global:
  scrape_interval: 15s

# Правила для алертов
rule_files:
  # - "first_rules.yml" # Можно будет добавить позже

# Сюда добавляем конфигурацию Alertmanager
alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - localhost:9093

# Конфигурация сбора метрик
scrape_configs:
  - job_name: 'prometheus'
    static_configs:
    - targets: ['localhost:9090']
  - job_name: 'node_exporter'
    static_configs:
    - targets: ['localhost:9100']
```

```bash
# Перезапускаем Prometheus для применения конфига
sudo systemctl restart prometheus
sudo systemctl enable --now prometheus-alertmanager
```

### Шаг 3: Установка и настройка Grafana

**Теория:** Устанавливаем Grafana и подключаем к ней Prometheus как источник данных.

```bash
# Устанавливаем Grafana
sudo apt install -y grafana
sudo systemctl enable --now grafana-server
```
**Настройка в веб-интерфейсе:**
1.  **Вход:** Откройте `http://<IP_сервера>:3000`. Логин/пароль: `admin`/`admin`. Смените пароль.
2.  **Добавление источника данных (Data Source):**
    *   Configuration (шестеренка) -> Data Sources -> Add data source -> Prometheus.
    *   URL: `http://localhost:9090`.
    *   Нажмите "Save & Test".
3.  **Импорт дашборда:**
    *   Create (+) -> Import.
    *   ID дашборда: `1860` (Node Exporter Full).
    *   Нажмите "Load", выберите ваш Prometheus источник данных, нажмите "Import".
    *   Вы увидите готовый дашборд с метриками вашего сервера.

---

## Часть 3: Руководство пользователя по ГОСТ Р 59795-2021

*(Создайте файл `grafana_guide.md` и скопируйте туда этот текст. Это будет ваш документ для сдачи.)*

```markdown
# Руководство пользователя
## Система визуализации данных Grafana

### Введение

Настоящее руководство предназначено для сотрудников IT-отдела и описывает порядок использования панели визуализации Grafana для мониторинга состояния корпоративных сервисов и ресурсов.

Grafana — это программная платформа с открытым исходным кодом для анализа и визуализации данных. В рамках нашей инфраструктуры она используется для отображения метрик производительности серверов (CPU, RAM, Disk, Network) и журналов событий в удобном графическом виде.

### Требования к системе пользователя

*   Современный веб-браузер (Google Chrome, Mozilla Firefox, Edge).
*   Доступ к корпоративной сети.

### Порядок работы

#### 1. Доступ к системе

1.  Откройте веб-браузер и перейдите по адресу: `http://<IP_сервера_мониторинга>:3000`.
2.  Введите логин и пароль, предоставленные системным администратором.

#### 2. Основной интерфейс

После входа вы попадаете на главную страницу. Основными элементами навигации являются:
*   **Левое меню:** Предоставляет доступ ко всем функциям: поиску, созданию дашбордов, настройкам и т.д.
*   **Дашборды (Dashboards):** Готовые наборы визуализаций, отображающие состояние конкретной системы или сервиса.

#### 3. Просмотр дашбордов

1.  В левом меню выберите "Dashboards".
2.  Найдите в списке интересующий вас дашборд, например, "Node Exporter Full" для просмотра общей информации о состоянии сервера.
3.  На открывшейся странице вы увидите графики и индикаторы, отображающие метрики в реальном времени.
4.  В правом верхнем углу можно изменить временной диапазон отображаемых данных (например, "Last 5 minutes", "Last 24 hours").

#### 4. Анализ данных (Explore)

Функция "Explore" позволяет выполнять запросы к источникам данных напрямую, что полезно для глубокого анализа и поиска неисправностей.

1.  В левом меню выберите "Explore" (иконка компаса).
2.  В выпадающем списке вверху выберите источник данных (например, Prometheus).
3.  Введите запрос в поле "Metrics browser" для анализа конкретной метрики.

### Завершение работы

Для выхода из системы нажмите на иконку вашего профиля в левом нижнем углу и выберите "Sign out".

---

## Часть 4: План демонстрации результатов экзаменатору

1.  **Показать безопасность:** Выполнить `sudo ufw status` и `sudo systemctl status fail2ban`, пояснив, что сервер защищен брандмауэром и от атак перебора паролей.
2.  **Показать работающие службы:** Выполнить `systemctl status prometheus grafana-server prometheus-node-exporter prometheus-alertmanager`, показав, что все компоненты запущены.
3.  **Продемонстрировать мониторинг в Grafana:**
    *   Открыть в браузере `http://<IP>:3000`.
    *   Показать импортированный дашборд "Node Exporter Full". Обратить внимание экзаменатора на графики CPU, RAM, Network, которые обновляются в реальном времени.
4.  **Продемонстрировать настройку алертинга:**
    *   Открыть UI Prometheus `http://<IP>:9090`.
    *   Перейти на вкладку "Alerts". Показать, что пока алертов нет.
    *   Перейти на вкладку "Status" -> "Targets" и показать, что Alertmanager подключен. Пояснить, что при превышении порогов (которые задаются в rule_files) Prometheus отправит сюда уведомление.
5.  **Показать документацию:** Открыть файл `grafana_guide.md` и кратко рассказать о его содержимом.
6.  **Защитить выбор ПО:** Устно рассказать обоснование из Части 1, делая акцент на том, почему стек Prometheus/Grafana/Alertmanager является современным и эффективным решением для задач мониторинга.
