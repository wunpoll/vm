## Часть 1: Правильная настройка VirtualBox для Linux

**Теория:**
Виртуальная машина (ВМ) — это эмуляция реального компьютера внутри вашей основной операционной системы. Качество ее работы напрямую зависит от ресурсов, которые мы ей выделим.
*   **ОЗУ (RAM):** Linux сам по себе не требует много памяти, но графические окружения (как в Ubuntu/Mint) и приложения (IDE, браузеры) потребляют ее активно. **4 ГБ (4096 МБ)** — это комфортный минимум для разработки или серверных задач.
*   **Процессоры (CPU):** Современные ОС и программы хорошо распараллеливают задачи. Выделение **2-4 ядер** позволит ВМ выполнять несколько процессов одновременно, не "замораживая" интерфейс, и значительно ускорит компиляцию или установку ПО.
*   **Жесткий диск:** **Динамический диск** — это лучший выбор. Он занимает на вашем реальном компьютере ровно столько места, сколько данных внутри ВМ, и "растет" по мере необходимости до указанного лимита. Это экономит место.
*   **Сеть:** **NAT** создает виртуальную сеть за вашим компьютером, ВМ получает доступ в интернет через него, но "невидима" для других устройств в сети. **Сетевой мост (Bridged)** делает ВМ полноценным участником вашей локальной сети, что необходимо для тестирования серверного ПО.
*   **3D-ускорение:** Эта опция позволяет гостевой ОС напрямую использовать ресурсы вашей видеокарты для отрисовки графики, что критически важно для плавности интерфейса, просмотра видео и, тем более, для 3D-приложений.

---

## Часть 2: Базовая настройка ОС и установка ПО

### 2.1 Настройка параметров ОС, драйверов и служб

**Теория:**
После установки ОС содержит пакеты и драйверы, актуальные на момент создания дистрибутива. Первым делом нужно синхронизировать локальный список пакетов с онлайн-репозиториями (`update`) и затем обновить все установленное ПО до последних версий (`upgrade`). Это закрывает уязвимости и исправляет ошибки.
Проприетарные драйверы (особенно для видеокарт) содержат оптимизации от производителя, которые в разы повышают производительность по сравнению с универсальными open-source аналогами.
Службы (или демоны) — это программы, работающие в фоне. `systemd` (и его утилита `systemctl`) — это стандартная система для управления ими в большинстве современных дистрибутивов Linux.

```bash
# Обновляем систему
# sudo (SuperUser Do) - выполняет команду с правами администратора (root).
# apt (Advanced Package Tool) - основной менеджер пакетов в Debian-based системах (Ubuntu, Mint).
# update - скачивает свежие списки пакетов и их версий с удаленных серверов (репозиториев).
sudo apt update && sudo apt upgrade -y

# Установка проприетарных драйверов
# ubuntu-drivers - утилита для управления драйверами.
# autoinstall - автоматически находит и устанавливает наилучший рекомендованный драйвер для вашего оборудования.
sudo ubuntu-drivers autoinstall
# ПЕРЕЗАГРУЗКА ОБЯЗАТЕЛЬНА, чтобы ядро Linux загрузило новые модули драйверов.
# sudo reboot

# Установка набора полезных утилит
# install - команда apt для установки пакетов.
# -y - флаг, который автоматически отвечает "yes" на все вопросы установщика.
# htop - интерактивный монитор процессов.
# mc - Midnight Commander, двухпанельный файловый менеджер для терминала.
# net-tools - содержит классические утилиты, такие как ifconfig.
# neofetch - выводит красивую сводку о системе.
# git - система контроля версий, стандарт для разработки.
# gimp, vlc - популярный графический редактор и медиаплеер.
# curl, wget - утилиты для скачивания файлов и данных по сети.
# build-essential - метапакет, который устанавливает все необходимое для компиляции программ из исходников (компилятор gcc, make и т.д.).
# vim - мощный текстовый редактор.
sudo apt install -y htop mc net-tools neofetch git gimp vlc curl wget build-essential vim

# Управление службами (на примере SSH)
# systemctl - главный инструмент для управления systemd.
# enable - добавляет службу в автозагрузку.
# start - запускает службу в текущей сессии.
# status - показывает подробную информацию о состоянии службы, включая последние записи в логе.
sudo systemctl enable ssh
sudo systemctl start ssh
sudo systemctl status ssh
```

### 2.2 Настройка интернет-соединения и брандмауэра

**Теория:**
`nmcli` (NetworkManager Command-Line Interface) позволяет управлять всеми аспектами сети из командной строки. Брандмауэр `ufw` (Uncomplicated Firewall) — это простой интерфейс для мощной, но сложной системы `iptables`. По умолчанию он работает по принципу "запрещено всё, что не разрешено". Мы должны явно открыть порты для сервисов, к которым хотим предоставить доступ извне. `Wireshark` "слушает" сетевой интерфейс и детально расшифровывает каждый проходящий через него пакет, что бесценно для отладки сетевых приложений.

```bash
# Проверка текущего состояния сети
# ip addr show - современная команда для отображения IP-адресов и сетевых интерфейсов.
ip addr show
# nmcli device status - показывает физические сетевые устройства и их состояние.
nmcli device status
# ping - отправляет ICMP-запросы на указанный хост для проверки доступности. -c 4 - отправить 4 пакета.
ping -c 4 google.com

# Настройка брандмауэра UFW
# ufw allow <порт/имя_сервиса> - создает правило, разрешающее входящий трафик на указанный порт.
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
# enable - активирует брандмауэр с текущими правилами.
sudo ufw enable
# status verbose - показывает активные правила в развернутом виде.
sudo ufw status verbose

# Установка анализатора трафика Wireshark
sudo apt install -y wireshark
# dpkg-reconfigure - перенастраивает уже установленный пакет. Для wireshark-common это позволяет дать права на захват трафика не-root пользователям.
sudo dpkg-reconfigure wireshark-common
# usermod -aG <группа> <пользователь> - добавляет (-a) пользователя в группу (-G). Членство в группе 'wireshark' дает право на прослушивание сети.
sudo usermod -aG wireshark $USER
```

### 2.3 и 2.4 Установка базового ПО и виртуального принтера

**Теория:**
Репозитории дистрибутива содержат тысячи готовых к установке программ. `LibreOffice` — это мощный бесплатный аналог Microsoft Office. `CUPS` (Common Unix Printing System) — это стандартный сервер печати в Linux. Установив пакет `cups-pdf`, мы добавляем в систему виртуальный принтер, который вместо отправки задания на физическое устройство преобразует его в PDF-файл и сохраняет на диске.

```bash
# Установить полный офисный пакет LibreOffice
sudo apt install -y libreoffice
# Установить калькулятор
sudo apt install -y gnome-calculator

# Установить систему печати CUPS и PDF-принтер
sudo apt install -y cups cups-pdf
sudo systemctl enable --now cups # --now = enable + start
```

---

## Часть 3: Безопасность, восстановление и совместимость

### 3.1 и 3.2 Резервное копирование и точки восстановления

**Теория:**
Существует два основных подхода к бэкапу: **образ диска** и **снимок файловой системы**.
**Клонирование/экспорт ВМ** — это создание полного побитового образа диска. Это надежно, но медленно и требует много места.
**Timeshift** работает на уровне файлов. Он использует технологию rsync (для инкрементальных копий) и жесткие ссылки, чтобы создавать "снимки" системных директорий (`/etc`, `/usr` и т.д.). Каждый снимок занимает очень мало места, так как хранит только изменения по сравнению с предыдущим. Это идеальный инструмент для быстрого отката неудачных обновлений или изменений конфигурации.

```bash
# Установить Timeshift
sudo apt install -y timeshift
# Создать снимок системы с комментарием
# --create - флаг для создания снимка.
# --comments - флаг для добавления текстового описания, что очень помогает при восстановлении.
sudo timeshift --create --comments "Базовая настройка системы завершена. Готов к выполнению билета."
# --list - выводит таблицу всех существующих снимков.
sudo timeshift --list
```

#### Установка ClamAV

```bash
# Устанавливаем сам сканер (clamav) и демон для обновления баз (clamav-daemon)
# clamav-daemon позволит базам обновляться автоматически в фоне.
sudo apt install -y clamav clamav-daemon
```

**Теория:** Сканирование выполняется командой `clamscan`. У нее есть множество полезных флагов, которые позволяют настроить проверку.

*   `-r` — рекурсивно сканировать все поддиректории.
*   `-i` — показывать в отчете только зараженные файлы.
*   `--move=/path/to/quarantine` — переместить зараженные файлы в указанную карантинную папку.
*   `--remove` — **(ОПАСНО!)** немедленно удалить зараженные файлы.

```bash
# Создадим папку для карантина, куда будем перемещать подозрительные файлы
sudo mkdir /var/quarantine
sudo chown clamav:clamav /var/quarantine # Даем права на папку пользователю антивируса

# Пример сканирования домашней директории с выводом только инфицированных файлов
# и перемещением их в карантин.
# Это самый безопасный и рекомендуемый способ.
sudo clamscan -r -i --move=/var/quarantine /home

# Пример сканирования всего корневого каталога (может занять много времени)
# sudo clamscan -r -i --move=/var/quarantine /
```

### 3.3 Создание пользователей и настройка прав доступа

**Теория:**
Linux — многопользовательская система с развитой моделью прав. Каждый файл принадлежит **пользователю** (owner) и **группе** (group). Права доступа (`r` - read, `w` - write, `x` - execute) назначаются для трех категорий: для владельца, для членов группы и для всех остальных. Команда `chmod 775` — это числовое представление прав: `7 (rwx)` для владельца, `7 (rwx)` для группы, `5 (r-x)` для остальных. Это позволяет гибко управлять доступом к общим ресурсам.

```bash
# adduser - интерактивная утилита для создания нового пользователя.
sudo adduser testuser
# addgroup - создает новую группу.
sudo addgroup testers
# usermod -aG - добавляет пользователя в дополнительную группу.
sudo usermod -aG testers testuser

# Создадим общую папку и настроим на нее права
sudo mkdir /opt/shared_data
# chown <user>:<group> - меняет владельца и группу файла/директории.
sudo chown root:testers /opt/shared_data
# chmod <права> - меняет права доступа.
sudo chmod 775 /opt/shared_data
```

### 3.4 Аутентификация, логи

**Теория:**
`journald` — это компонент `systemd`, который собирает логи со всей системы в единый бинарный журнал. Утилита `journalctl` позволяет делать по нему сложные запросы: фильтровать по службе (`-u`), по уровню важности (`-p`), по времени и т.д.
64-битные системы не могут по умолчанию запускать 32-битные программы. Команда `dpkg --add-architecture i386` сообщает системе управления пакетами, что нужно также искать и 32-битные версии библиотек, делая систему мультиархитектурной.
**"Дополнения гостевой ОС"** — это критически важный компонент для любой ВМ. Он устанавливает в гостевую ОС специальные драйверы, которые позволяют ей "общаться" с хостовой системой: синхронизировать время, использовать общий буфер обмена, а главное — получать информацию о размере окна VirtualBox и автоматически подстраивать под него разрешение экрана.

```bash
# Просмотр логов через journalctl
# -f - follow, следить за логом в реальном времени.
journalctl -f
# -u ssh - unit, показать логи только от службы ssh.
journalctl -u ssh
# -p 3 - priority, показать сообщения с приоритетом 3 (ошибка) и выше (критические).
# -b - boot, показать логи с момента последней загрузки.
journalctl -p 3 -b
```

### 3.5 Решение проблем с дисплеем и совместимостью (GUI)

```bash
# Включить поддержку 32-битной архитектуры
sudo dpkg --add-architecture i386
sudo apt update
sudo apt install -y libc6:i386 libncurses5:i386 libstdc++6:i386
```
**Низкое разрешение**
1.  Откройте **"Параметры"** ("Settings") системы.
2.  Перейдите в раздел **"Экран"** или **"Дисплеи"** ("Screen Display" или "Displays").
3.  Найдите опцию **"Масштаб"** ("Scale").
4.  **Варианты решения:**
    *   **Если все слишком мелкое:** Выберите масштаб **200%**. Это сделает все элементы в два раза больше. Этот вариант идеален для 4K-мониторов.
    *   **Если все слишком крупное или размытое:** Убедитесь, что выбран масштаб **100%**. Если доступна опция **"Дробное масштабирование"** ("Fractional Scaling"), **отключите** ее. 
5.  Примените изменения. Система может попросить вас выйти и войти снова, чтобы изменения вступили в силу.
